Non-negotiable constraint
Do not alter any existing functions in 1.1.0_birha.py. Treat them as read-only reference.
You may only add new functions, dataclasses, constants, and unit tests.
No renames, no signature changes, no in-place edits, no deleted lines in existing code.

---

# Full Prompt (Thorough) – Task 12

**Context**
You are enhancing *Birha v1.1.0* (Tkinter app). The source of truth is **@Prompt_CODEX.txt** and **@0.1.7.3 Axioms_framework Engineering Contract — Birha V1.1.docx**. Implement **Task 12 only**: the Testing Harness, to provide repeatable tests for stores, scanners, and mappers. All changes must be additive. 

---

**Non-negotiables**

* Do **not** alter any existing functions, constants, or strings in `1.1.0_birha.py`.
* No renames, refactors, in-place edits, or deletions.
* Add all new code only under this header:
  `# === Axioms T12: Testing Harness (additive only) ===`
* Canonical headers and string constants must remain untouched.

---

**Deliverables**

1. **Test suite structure**
   Create a new directory `tests/axioms/` with modules covering Tasks 1–11.

* `test_task1_category.py`
* `test_task2_store_adapter.py`
* `test_task3_workbench.py`
* `test_task4_driver.py`
* `test_task5_scanner.py`
* `test_task6_catalog.py`
* `test_task7_prompt.py`
* `test_task8_descriptions.py`
* `test_task9_keywords.py`
* `test_task10_nonexplicit.py`
* `test_task11_csv.py`

2. **Fixtures**

* Use `TemporaryDirectory` for store_path isolation.
* Mock minimal Excel/CSV data with `pandas`.
* Provide sample `verse_key` and dummy axiom entries.

3. **Minimal Tk adapters**

* Wrap Tk tests with guards: `@unittest.skipIf("DISPLAY" not in os.environ, "No display available")`.
* Use `root = tk.Tk(); root.withdraw()` for headless contexts.

---

**Acceptance Criteria**

* Running `pytest tests/axioms/` passes all unit tests without requiring manual setup.
* Headless environments skip Tk tests cleanly (no `TclError`).
* Store round-trips (Excel/CSV) are tested and verified for schema lock.
* Reanalysis scanner correctly enqueues missing/revised verses.
* Catalog CRUD, prompt generation, description revisions, and keyword deduplication all verified.
* Non-Explicit linking flow tested with multiple primaries and circular detection.
* CSV export/import round-trip validated.

---

**Tests to include**

* **Category mapping**: All combinations of Framework/Explicit flags → Primary/Secondary.
* **Store adapters**: Create, update, query on all sheets.
* **Workbench smoke**: Window opens and closes without errors.
* **Driver pause/resume**: State persists across restart.
* **Scanner**: Adds missing Framework=1 verses; marks reanalysis when revisions advance.
* **Catalog CRUD**: Unique axiom_id, no duplicate links.
* **Prompt generator**: Output contains verse, flags, category, and actions.
* **Descriptions engine**: Verse-specific append, axiom-specific revision increments.
* **Keyword manager**: Stop-words rejected, duplicates deduped, density warnings appear.
* **Non-explicit linking**: Secondary blocked without Primary, circular detection works.
* **CSV bridges**: Export → Import → Export round-trip identical.

---

**PR Workflow**

* Branch: `feature/axioms-T12-testing-harness`
* Commit: `test(axioms): T12 add testing harness with fixtures for stores, scanners, and mappers`
* PR Title: `Axioms T12 — Testing Harness`
* PR Body Checklist:

  * [ ] Additive only, no edits to existing functions/constants
  * [ ] Test suite covers Tasks 1–11
  * [ ] Headless Tk tests skip gracefully
  * [ ] Round-trip and scanner logic verified
  * [ ] All tests green

---
