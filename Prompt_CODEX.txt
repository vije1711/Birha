Non-negotiable constraint
Do not alter any existing functions in 1.1.0_birha.py. Treat them as read-only reference.
You may only add new functions, dataclasses, constants, and unit tests.
No renames, no signature changes, no in-place edits, no deleted lines in existing code.

Full Prompt (Thorough) – Task 7

Context
You are enhancing Birha v1.1.0 (Tkinter app). The source of truth is @Prompt_CODEX.txt and its reference @0.1.7.3 Axioms_framework Engineering Contract — Birha V1.1.docx. Implement Task 7 only: Prompt Generator for finalizing Axioms for a given verse. All changes must be additive.

Non-negotiables

Do not alter any existing functions, constants, or strings in 1.1.0_birha.py. Treat current code as read-only reference.

No renames, refactors, in-place edits, or deletions.

Add all new code only under this header:
# === Axioms T7: Finalize Axiom Prompt Generator (additive only) ===

Canonical headers and string constants must remain untouched.

Deliverables

New function

def build_axiom_finalization_prompt(
    verse_key: str,
    store_path: Optional[Union[str, Path]] = None
) -> str:
    """
    Build a structured prompt containing:
      - Verse text (from assessment_data.xlsx)
      - Current translation
      - Grammar highlights (optional: may be stubbed now, to be extended later)
      - Framework? and Explicit? flags, and derived Category (via T1)
      - Existing linked Axioms from AxiomsStore
      - Guidance text to either create new Axioms or link existing ones
    Returns a markdown/plaintext string for downstream use.
    """


Content rules

Prompt must include verse text and translation from assessment_data.xlsx (via helper).

Include Framework? and Explicit? values with category computed using T1’s derive_axiom_category().

Query AxiomsStore.find_axioms() for catalog excerpts (law text + IDs).

If contributions exist (via AxiomContribStore.list_contributions), include them.

Output should be formatted in markdown with clear sections:

Verse Context

Flags & Category

Existing Axioms

Actions → “Create new Axiom” / “Link existing Axiom(s)” / “Link multiple”.

Optional helpers

_format_axiom_catalog(records: list[dict]) -> str to keep output neat.

_fetch_verse_context(verse_key: str) to isolate assessment lookups.

Acceptance Criteria

Calling build_axiom_finalization_prompt(verse_key) returns a markdown/plaintext string with:

The verse text and translation.

Flags (Framework, Explicit) + Category.

Current catalog of Axioms (if any).

Contribution info if verse is already linked.

Clear next-step guidance (create/link/link multiple).

Prompt is well-structured and readable (section headers, bullet lists where appropriate).

Unit tests confirm all elements appear given mock data.

No changes to existing code outside the additive header.

Tests
File: tests/axioms/test_task7_prompt.py

test_prompt_includes_flags_and_category() → verify category text appears.

test_prompt_includes_existing_axioms() → mock AxiomsStore and confirm output lists them.

test_prompt_includes_contributions_if_present() → ensure contributions section shows up.

test_prompt_structure_sections_present() → assert sections (Verse Context, Flags & Category, Existing Axioms, Actions).

Use a TemporaryDirectory and mock Excel/CSV stores for isolation.

PR Workflow

Branch: feature/axioms-T7-finalize-prompt

Commit: feat(axioms): T7 add prompt generator for finalizing axioms (additive only)

PR Title: Axioms T7 — Finalize Axiom Prompt Generator

PR Body Checklist:

 Additive only, no edits to existing functions/constants

 Prompt generator returns correct markdown/plaintext output

 Existing axioms and contributions appear in prompt

 Sections present and clearly labeled

 Unit tests green