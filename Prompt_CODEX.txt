Non-negotiable constraint
Do not alter any existing functions in 1.1.0_birha.py. Treat them as read-only reference.
You may only add new functions, dataclasses, constants, and unit tests.
No renames, no signature changes, no in-place edits, no deleted lines in existing code.

Full Prompt (Thorough) – Task 8

Context
You are enhancing Birha v1.1.0 (Tkinter app). The source of truth is @Prompt_CODEX.txt and @0.1.7.3 Axioms_framework Engineering Contract — Birha V1.1.docx. Implement Task 8 only: the Descriptions Engine, handling both verse-specific and axiom-specific descriptions with append/redraft decision logic. All changes must be additive.

Non-negotiables

Do not alter any existing functions, constants, or strings in 1.1.0_birha.py. Treat current code as read-only reference.

No renames, refactors, in-place edits, or deletions.

Add all new code only under this header:
# === Axioms T8: Descriptions Engine (additive only) ===

Canonical headers and string constants must remain untouched.

Deliverables

New functions

def build_description_prompt(
    axiom_id: str,
    verse_key: Optional[str] = None,
    store_path: Optional[Union[str, Path]] = None
) -> str:
    """
    Build a structured prompt that includes:
      - Prior verse-specific descriptions (for the verse, if any)
      - Current axiom-specific description (latest revision)
      - Decision instruction: append a new verse-specific description or redraft axiom-specific one
    Returns a markdown/plaintext string suitable for downstream use.
    """

def save_description(
    axiom_id: str,
    type: str,
    text: str,
    verse_key: Optional[str] = None,
    store_path: Optional[Union[str, Path]] = None
) -> dict:
    """
    Save a description record into AxiomDescriptions.
      - If type == 'verse_specific': create a new row with verse_key.
      - If type == 'axiom_specific': increment revision if text changed, preserve prior rows for history.
    Returns the saved record.
    """


Content rules

Verse-specific descriptions: tied to a verse_key; each save creates a new row.

Axiom-specific descriptions: tied only to axiom_id; if text changes, increment revision and preserve history.

Prompt must present both prior verse-specific entries and the latest axiom-specific text, then instruct whether to append (verse) or redraft (axiom).

Format prompt in markdown with clear sections: Verse-Specific Descriptions, Axiom-Specific Description, Decision Guidance.

Optional helpers

_fetch_descriptions(axiom_id, type, verse_key) to isolate store lookups.

_format_description_history(records) for neat markdown output.

Acceptance Criteria

build_description_prompt(axiom_id, verse_key) returns a string containing:

Any prior verse-specific descriptions for that verse.

The latest axiom-specific description (with revision number).

Clear guidance on whether to append or redraft.

save_description() correctly:

Adds new verse-specific description rows.

Creates a new axiom-specific row with incremented revision when text differs from the latest.

History of descriptions preserved; no overwrites.

Unit tests confirm correct saving, revision increments, and prompt output.

No modifications to existing code; all additions in the Task 8 header block.

Tests
File: tests/axioms/test_task8_descriptions.py

test_save_and_fetch_verse_specific_description() → create a verse-specific record and verify prompt shows it.

test_save_axiom_specific_creates_revision() → saving new axiom-specific text increments revision, old revision still retrievable.

test_prompt_includes_prior_descriptions() → prompt output includes past verse-specific entries and axiom-specific description.

test_prompt_structure_sections_present() → assert sections appear in markdown.

Use TemporaryDirectory and mock Excel stores for isolation.

PR Workflow

Branch: feature/axioms-T8-descriptions-engine

Commit: feat(axioms): T8 add descriptions engine for verse/axiom-specific records (additive only)

PR Title: Axioms T8 — Descriptions Engine (verse-specific & axiom-specific)

PR Body Checklist:

 Additive only, no edits to existing functions/constants

 build_description_prompt() returns structured output with history and guidance

 save_description() handles both verse-specific and axiom-specific correctly

 Revisions increment properly; history preserved

 Unit tests green