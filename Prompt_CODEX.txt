Non-negotiable constraint
Do not alter any existing functions in 1.1.0_birha.py. Treat them as read-only reference.
You may only add new functions, dataclasses, constants, and unit tests.
No renames, no signature changes, no in-place edits, no deleted lines in existing code.

Full Prompt (Thorough) – Task 9

Context
You are enhancing Birha v1.1.0 (Tkinter app). The source of truth is @Prompt_CODEX.txt and @0.1.7.3 Axioms_framework Engineering Contract — Birha V1.1.docx. Implement Task 9 only: the Keyword Manager, handling the four keyword categories per axiom (Literal Synonyms, Literal Antonyms, Spiritual Synonyms, Spiritual Antonyms). All changes must be additive.

Non-negotiables

Do not alter any existing functions, constants, or strings in 1.1.0_birha.py. Treat current code as read-only reference.

No renames, refactors, in-place edits, or deletions.

Add all new code only under this header:
# === Axioms T9: Keyword Manager (additive only) ===

Canonical headers and string constants must remain untouched.

Deliverables

New functions

def build_keywords_prompt(
    axiom_id: str,
    bucket: str,
    store_path: Optional[Union[str, Path]] = None
) -> str:
    """
    Build a structured prompt for managing keywords in the given bucket.
    Sections include:
      - Current keywords for this axiom in the specified bucket
      - Guidance for generating new keywords (synonyms/antonyms, literal/spiritual)
      - Deduplication notice and cross-axiom density warnings
    Returns a markdown/plaintext string.
    """

def merge_keywords(
    axiom_id: str,
    bucket: str,
    new_keywords: List[str],
    store_path: Optional[Union[str, Path]] = None
) -> List[dict]:
    """
    Merge a list of candidate keywords into the store for this axiom+bucket.
      - Deduplicates case-insensitively
      - Skips stop-words and too-short tokens
      - Preserves prior entries with timestamps
    Returns the updated keyword list.
    """

def delete_keyword(
    axiom_id: str,
    bucket: str,
    keyword: str,
    store_path: Optional[Union[str, Path]] = None
) -> bool:
    """
    Delete a keyword from the specified axiom+bucket if present.
    Returns True if deleted, False if not found.
    """


Content rules

Buckets supported: "LiteralSyn", "LiteralAnt", "SpiritualSyn", "SpiritualAnt".

Stop-words: ignore generic tokens like “and”, “the”, “of”.

Min length: ignore tokens shorter than 3 chars.

Deduplicate within bucket case-insensitively.

Cross-axiom density: compute frequency of each keyword across all axioms; mark those that appear in more than N axioms (e.g. N=5) with a warning in the prompt.

Prompt output should have clear sections: Current Keywords, Guidance for New Keywords, Warnings.

Optional helpers

_normalize_keyword(token: str) -> str for canonical form.

_cross_axiom_keyword_density(keyword: str) -> int to count usage across all axioms.

Acceptance Criteria

build_keywords_prompt() produces a string listing current keywords, guidance, and warnings.

merge_keywords() adds new tokens, rejects duplicates, ignores invalids, and preserves existing entries.

delete_keyword() removes exact matches when requested.

Case-insensitive dedupe works (e.g., “Truth” vs “truth”).

Cross-axiom density warnings appear when a keyword occurs in >N axioms.

Unit tests cover merges, deletes, dedupes, and warnings.

No modifications to existing code outside additive header.

Tests
File: tests/axioms/test_task9_keywords.py

test_merge_keywords_adds_and_dedupes() → add mixed-case words, confirm deduplication.

test_merge_keywords_filters_stopwords_and_short_tokens() → confirm these are skipped.

test_delete_keyword_removes_entry() → ensure True/False return is correct.

test_build_keywords_prompt_includes_current_and_warnings() → prompt lists existing + warning for high-density words.

test_cross_axiom_density_check() → confirm frequency counts trigger warnings at threshold.

Use TemporaryDirectory and mock Excel stores for isolation.

PR Workflow

Branch: feature/axioms-T9-keyword-manager

Commit: feat(axioms): T9 add keyword manager (4 buckets, additive only)

PR Title: Axioms T9 — Keyword Manager (4 Buckets)

PR Body Checklist:

 Additive only, no edits to existing functions/constants

 build_keywords_prompt() outputs structured keyword guidance

 merge_keywords() dedupes, filters, preserves history

 delete_keyword() works correctly

 Cross-axiom density check included

 Unit tests green